<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LogicApt - Feedback Form</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --primary-color: #ff7f27;
      --secondary-color: #333;
      --background-color: #f5f6fa;
      --card-shadow: 0 3px 8px rgba(0,0,0,0.08);
    }
    
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background-color: var(--background-color);
      color: var(--secondary-color);
    }

    a { text-decoration: none; }

    .top-nav {
      background: #000;
      color: #fff;
      padding: 8px 0;
      font-size: 14px;
      border-bottom: 1px solid #222;
    }

    .top-nav a {
      color: #c8cdd6;
      margin-right: 20px;
      transition: color 0.3s;
    }
    
    .top-nav a:hover {
      color: #fff;
    }

    .circle-icon {
      width: 28px;
      height: 28px;
      border: 2px solid #ffffff;
      border-radius: 50%;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-size: 13px;
      margin-left: 10px;
      transition: all 0.3s;
    }
    
    .circle-icon:hover {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }

    header {
      background: #fff;
      padding: 15px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .logo { height: 70px; }

    h1 {
      color: var(--primary-color);
      margin: 0;
      font-size: 24px;
      font-weight: 600;
    }

    .form-card {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: var(--card-shadow);
      margin-bottom: 30px;
    }

    .fade-in {
      opacity: 0;
      animation: fadeIn 0.9s forwards ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .first-section {
      margin-top: 40px;
    }

    .rating-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .form-check-inline {
      margin-right: 0;
    }
    
    .form-check-input:checked {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .form-check-label {
      margin-left: 5px;
    }
    
    .error-message {
      color: #dc3545;
      font-size: 0.875em;
      margin-top: 5px;
      display: none;
    }
    
    .form-control:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.25rem rgba(255, 127, 39, 0.25);
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .btn-primary:hover, .btn-primary:focus {
      background-color: #e67322;
      border-color: #e67322;
    }
    
    footer {
      background: #fff;
      padding: 60px 0 30px 0;
      border-top: 1px solid #ddd;
      margin-top: 70px;
    }

    .footer-social a {
      border: 2px solid var(--primary-color);
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      margin-right: 12px;
      color: var(--primary-color);
      font-size: 17px;
      transition: all 0.3s;
    }
    
    .footer-social a:hover {
      background-color: var(--primary-color);
      color: white;
    }

    .footer-bottom {
      text-align: center;
      margin-top: 30px;
      color: #666;
      font-size: 14px;
    }
    
    @media (max-width: 768px) {
      .form-card {
        padding: 20px 15px;
      }
      
      .col-md-4.fw-bold {
        margin-bottom: 10px;
      }
      
      .rating-group {
        gap: 10px;
      }
      
      footer {
        padding: 40px 0 20px 0;
        margin-top: 70px;
      }
    }
  </style>

</head>

<body>

<div class="top-nav">
  <div class="container d-flex justify-content-between flex-wrap">

    <div>
      <a href="#"><i class="fa fa-question-circle"></i> FAQ</a>
      <a href="https://www.google.com/maps/search/?api=1&query=A-40A Landmark Plaza Mohali" target="_blank">
        <i class="fa fa-map-marker-alt"></i> A-40A, Landmark Plaza, Mohali
      </a>
    </div>

    <div>
      <a href="mailto:abhay@logicapt.com"><i class="fa fa-envelope"></i> abhay@logicapt.com</a>
      <a href="tel:+14157278390"><i class="fa fa-phone"></i> +1 (415) 727 8390</a>

      <a href="https://linkedin.com/company/logicapt"
         target="_blank" class="circle-icon">
        <i class="fa-brands fa-linkedin"></i>
      </a>

      <a href="https://instagram.com/logicaptinformatics/"
         target="_blank" class="circle-icon">
        <i class="fa-brands fa-instagram"></i>
      </a>
    </div>

  </div>
</div>

<header>
  <div class="container d-flex align-items-center justify-content-between">
    <img src="https://raw.githubusercontent.com/logicapt/Feedback_Form/refs/heads/main/image-removebg-preview.png" class="logo" alt="LogicApt Logo" />
    <h1> Feedback Form</h1>
  </div>
</header>

<div class="container first-section">
  <div class="form-card">
    <h2 id="project-name" style="color:#ff7f27;">Loading Project...</h2>
    <div id="project-paragraph"></div>

    <div id="loading-spinner" class="text-center">
      <div class="spinner-border text-warning" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading project details...</p>
    </div>

    <p id="error-message" style="display:none; color:red; text-align:center;"></p>
  </div>
</div>

<div class="container">
  <div id="feedback-container" class="form-card fade-in" style="display:none;">

    <p>Thank you for your collaboration. Your feedback helps us improve our services.</p>

<form id="feedbackForm" novalidate>

  <!-- SEARCH QUALITY -->
  <div class="row mb-3">
    <div class="col-md-4 fw-bold">Search Quality: <span class="text-danger">*</span></div>
    <div class="col-md-8">
      <div class="rating-group">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="searchQuality" id="searchQuality1" value="1" required>
          <label class="form-check-label" for="searchQuality1">1</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="searchQuality" id="searchQuality2" value="2">
          <label class="form-check-label" for="searchQuality2">2</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="searchQuality" id="searchQuality3" value="3">
          <label class="form-check-label" for="searchQuality3">3</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="searchQuality" id="searchQuality4" value="4">
          <label class="form-check-label" for="searchQuality4">4</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="searchQuality" id="searchQuality5" value="5">
          <label class="form-check-label" for="searchQuality5">5</label>
        </div>
      </div>
      <div class="error-message" id="searchQualityError">Please provide a search quality rating</div>
    </div>
  </div>

  <!-- TURNAROUND TIME -->
  <div class="row mb-3">
    <div class="col-md-4 fw-bold">Turnaround Time: <span class="text-danger">*</span></div>
    <div class="col-md-8">
      <div class="rating-group">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="turnaroundTime" id="turnaroundTime1" value="1" required>
          <label class="form-check-label" for="turnaroundTime1">1</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="turnaroundTime" id="turnaroundTime2" value="2">
          <label class="form-check-label" for="turnaroundTime2">2</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="turnaroundTime" id="turnaroundTime3" value="3">
          <label class="form-check-label" for="turnaroundTime3">3</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="turnaroundTime" id="turnaroundTime4" value="4">
          <label class="form-check-label" for="turnaroundTime4">4</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="turnaroundTime" id="turnaroundTime5" value="5">
          <label class="form-check-label" for="turnaroundTime5">5</label>
        </div>
      </div>
      <div class="error-message" id="turnaroundTimeError">Please provide a turnaround time rating</div>
    </div>
  </div>

  <!-- REPORTING (NEW FIELD) -->
  <div class="row mb-3">
    <div class="col-md-4 fw-bold">Reporting: <span class="text-danger">*</span></div>
    <div class="col-md-8">
      <div class="rating-group">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="reporting" id="reporting1" value="1" required>
          <label class="form-check-label" for="reporting1">1</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="reporting" id="reporting2" value="2">
          <label class="form-check-label" for="reporting2">2</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="reporting" id="reporting3" value="3">
          <label class="form-check-label" for="reporting3">3</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="reporting" id="reporting4" value="4">
          <label class="form-check-label" for="reporting4">4</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="reporting" id="reporting5" value="5">
          <label class="form-check-label" for="reporting5">5</label>
        </div>
      </div>
      <div class="error-message" id="reportingError">Please provide a reporting rating</div>
    </div>
  </div>

  <!-- RESPONSIVENESS -->
  <div class="row mb-3">
    <div class="col-md-4 fw-bold">Responsiveness: <span class="text-danger">*</span></div>
    <div class="col-md-8">
      <div class="rating-group">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="responsiveness" id="responsiveness1" value="1" required>
          <label class="form-check-label" for="responsiveness1">1</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="responsiveness" id="responsiveness2" value="2">
          <label class="form-check-label" for="responsiveness2">2</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="responsiveness" id="responsiveness3" value="3">
          <label class="form-check-label" for="responsiveness3">3</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="responsiveness" id="responsiveness4" value="4">
          <label class="form-check-label" for="responsiveness4">4</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="responsiveness" id="responsiveness5" value="5">
          <label class="form-check-label" for="responsiveness5">5</label>
        </div>
      </div>
      <div class="error-message" id="responsivenessError">Please provide a responsiveness rating</div>
    </div>
  </div>

  <!-- OVERALL RATING -->
  <div class="row mb-3">
    <div class="col-md-4 fw-bold">Overall Rating: <span class="text-danger">*</span></div>
    <div class="col-md-8">
      <div class="rating-group">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="overallRating" id="overallRating1" value="1" required>
          <label class="form-check-label" for="overallRating1">1</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="overallRating" id="overallRating2" value="2">
          <label class="form-check-label" for="overallRating2">2</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="overallRating" id="overallRating3" value="3">
          <label class="form-check-label" for="overallRating3">3</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="overallRating" id="overallRating4" value="4">
          <label class="form-check-label" for="overallRating4">4</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="overallRating" id="overallRating5" value="5">
          <label class="form-check-label" for="overallRating5">5</label>
        </div>
      </div>
      <div class="error-message" id="overallRatingError">Please provide an overall rating</div>
    </div>
  </div>

  <p class="mb-2">
    <em>**Note: 1 indicates the lowest rating, and 5 indicates the highest rating.**</em>
  </p>

  <!-- COMMENTS -->
  <div class="mb-4">
    <label for="comments" class="form-label fw-bold">Help us to achieve Customer delights:</label>
    <textarea name="comments" id="comments" class="form-control" 
              placeholder="Scribble Anything..." rows="4"></textarea>
  </div>

  <button type="submit" class="btn btn-primary px-4" id="submit-button">
    Submit Feedback
  </button>

</form>

  </div>
</div>

<div class="container">
  <div id="thank-you-container" class="form-card text-center" style="display:none;">
    <h2 style="color:#ff7f27;">Thank You for Your Feedback!</h2>
    <p>Your input helps us improve our services.</p>
    <button type="button" onclick="editResponse()" class="btn btn-primary px-4">
      Edit Response
    </button>
  </div>
</div>

<footer>
  <div class="container">
    <div class="row">

      <div class="col-md-4 mb-4">
        <img src="https://raw.githubusercontent.com/logicapt/Feedback_Form/refs/heads/main/image-removebg-preview.png" style="height:55px;" alt="LogicApt Logo" />
        <h4 class="mt-3">Have a project?</h4>
        <p>WE CAN HELP</p>
        <p><a href="mailto:info@logicapt.com" style="color:#ff7f27;">info@logicapt.com</a></p>
      </div>

      <div class="col-md-4 mb-4">
        <h4>Our Office</h4>

        <p><strong>ADDRESS</strong></p>
        <p>
          <a href="https://www.google.com/maps/search/?api=1&query=A-40A Landmark Plaza Mohali" target="_blank">
            <i class="fa fa-map-marker-alt"></i>
            LogicApt Informatics Pvt. Ltd.<br>
            A-40A Landmark Plaza<br>
            Phase VIII Extension<br>
            Mohali - 160059 (Punjab), India
          </a>
        </p>

        <p><strong>PHONE</strong></p>
        <p><strong>India:</strong><br>
          +91 (172) 5093683<br>
          +91 97250 07842
        </p>

        <p><strong>USA:</strong><br>
          +1 (415) 727 8390
        </p>
      </div>

      <div class="col-md-4 mb-4">
        <h4>Find us on social media</h4>

        <div class="footer-social mt-3">
          <a href="https://linkedin.com/company/logicapt" target="_blank">
            <i class="fa-brands fa-linkedin"></i>
          </a>

          <a href="https://instagram.com/logicaptinformatics/" target="_blank">
            <i class="fa-brands fa-instagram"></i>
          </a>

          <a href="https://logicapt.com" target="_blank">
            <i class="fa fa-globe"></i>
          </a>
        </div>
      </div>

    </div>

    <div class="footer-bottom">
      Â© 2025 LogicApt. All rights reserved.
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyNUYwV_VhLrwtjEcbqSv8Z2HP-E5t0g2WA41zno0eDqccpNY3zMoDYVOs-lwyL-KWNgg/exec"; 
// ^^^ Make sure this is the deployment URL for THIS script

let currentProjectData = {};

window.onerror = function (msg, src, line, col, err) {
  console.error("JS Error:", msg, src, line, col, err);
  showError("JavaScript error: " + escapeHtml(String(msg)), true);
};

window.onunhandledrejection = function (evt) {
  console.error("Unhandled rejection:", evt.reason);
  showError("Request failed: " + escapeHtml(String(evt.reason?.message || evt.reason)), true);
};

function getQueryParam(name) {
  return new URLSearchParams(window.location.search).get(name);
}

function escapeHtml(str) {
  if (str === null || str === undefined) return "";
  return String(str)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

function showError(message, isFatal = false) {
  const spinner = document.getElementById("loading-spinner");
  if (spinner) spinner.style.display = "none";

  const para = document.getElementById("project-paragraph");
  if (para) para.innerHTML = '<p style="color:red;text-align:center;">' + message + "</p>";

  if (isFatal) {
    const fc = document.getElementById("feedback-container");
    if (fc) fc.style.display = "none";
  }
}

function setLoadingState(loading) {
  const btn = document.getElementById("submit-button");
  if (!btn) return;

  if (loading) {
    btn.disabled = true;
    btn.innerHTML =
      '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Submitting...';
  } else {
    btn.disabled = false;
    btn.textContent = "Submit Feedback";
  }
}

function jsonp(url, params) {
  return new Promise((resolve, reject) => {
    const cb = "cb_" + Date.now() + "_" + Math.floor(Math.random() * 1e6);
    const fullParams = { ...params, callback: cb };
    const qs = new URLSearchParams(fullParams).toString();

    const s = document.createElement("script");
    s.src = url + "?" + qs;
    s.async = true;

    const timer = setTimeout(() => {
      cleanup();
      reject(new Error("JSONP timeout (likely: Web App not public / wrong deployment URL / returned HTML)"));
    }, 20000);

    window[cb] = (data) => {
      clearTimeout(timer);
      cleanup();
      resolve(data);
    };

    s.onerror = () => {
      clearTimeout(timer);
      cleanup();
      reject(new Error("JSONP network/script load error (URL wrong or blocked)"));
    };

    function cleanup() {
      try { delete window[cb]; } catch (e) { window[cb] = undefined; }
      if (s.parentNode) s.parentNode.removeChild(s);
    }

    document.body.appendChild(s);
  });
}

function parseProjectFromUrl() {
  const pParam = getQueryParam("p");
  if (!pParam) return null;

  const clean = pParam.replace(/^\/+|\/+$/g, "");
  const parts = clean.split("/").filter(x => x.trim() !== "");
  if (parts.length >= 2) {
    return { clientCode: parts[0], projectCode: parts[1] };
  }
  return null;
}

function validateForm() {
  let ok = true;
  const required = [
    "searchQuality",
    "turnaroundTime",
    "reporting",
    "responsiveness",
    "overallRating"
  ];

  required.forEach((name) => {
    const checked = document.querySelector('input[name="' + name + '"]:checked');
    const errEl = document.getElementById(name + "Error");
    if (!checked) {
      if (errEl) errEl.style.display = "block";
      ok = false;
    } else {
      if (errEl) errEl.style.display = "none";
    }
  });

  return ok;
}

async function fetchProjectData(clientCode, projectCode) {
  const res = await jsonp(WEB_APP_URL, {
    op: "getProject",
    clientCode: String(clientCode),
    projectCode: String(projectCode)
  });

  console.log("getProject response:", res);

  if (res && res.status === "success" && res.project) return res.project;
  throw new Error(res?.message || "Project not found");
}

async function submitFeedback(formData, projectData) {
  setLoadingState(true);
  try {
    const res = await jsonp(WEB_APP_URL, {
      op: "submitFeedback",
      clientCode: String(projectData.client_code),
      projectCode: String(projectData.project_code),
      searchQuality: String(formData.searchQuality),
      turnaroundTime: String(formData.turnaroundTime),
      reporting: String(formData.reporting),
      responsiveness: String(formData.responsiveness),
      overallRating: String(formData.overallRating),
      comments: String(formData.comments || "")
    });

    console.log("submitFeedback response:", res);

    if (res && res.status === "success") return res;
    throw new Error(res?.message || "Submit failed");
  } finally {
    setLoadingState(false);
  }
}

function displayProjectData(project) {
  const nameEl = document.getElementById("project-name");
  const paraEl = document.getElementById("project-paragraph");

  const typeRaw = project.project_type || "";
  const type    = typeRaw.toLowerCase();
  const title   = project.project_title || "";
  const patent  = project.patent_number ? String(project.patent_number).trim() : "";

  let headingText = "";

  if (
    type.includes("patentability") ||
    type.includes("patentibility") ||
    (type.includes("patent") && (type.includes("search") || type.includes("analysis")))
  ) {
    headingText = title || patent || "Unnamed Project";
  } else if (
    type.includes("invalidation") || type.includes("invalidity") || type.includes("opposition") ||
    type.includes("infringement") || type.includes("infringment") || type.includes("clearance")
  ) {
    headingText = patent || title || "Unnamed Project";
  } else {
    headingText = title || patent || "Unnamed Project";
  }

  nameEl.textContent = headingText;
  paraEl.innerHTML = generateProjectParagraph(project);

  currentProjectData = project;

  document.getElementById("loading-spinner").style.display = "none";
  document.getElementById("feedback-container").style.display = "block";
}

function generateProjectParagraph(project) {
  const type   = (project.project_type || "").toString().trim();
  const code   = project.project_code || "";
  const client = project.client_code || "";
  const title  = project.project_title || "";
  const patent = project.patent_number || "";
  const product = project.product_name || "";

  const t = type.toLowerCase();

  if (t.includes("patentability") || t.includes("patentibility") ||
      (t.includes("patent") && (t.includes("search") || t.includes("analysis")))) {
    return `
     <p>Thank you for collaborating with us on this Patentability Search project.<br>
      Your insights help us assess the inventive step and novelty with accuracy.<br>
      Please provide your feedback to help us improve our search strategies.</p>
      <p><strong>Project Details:</strong><br>
      Project Code: ${escapeHtml(code)}<br>
      Client Code: ${escapeHtml(client)}<br>
      Type: Patentability Search<br></p>

      <p>Thank you for your valuable partnership.</p>
    `;
  } else if (t.includes("invalidation") || t.includes("invalidity") || t.includes("opposition")) {
    return `
      <p>We appreciate the opportunity to support you in this Invalidation Search project.<br>
      Your feedback helps us refine our methodology for identifying prior art and analysing patent strength.</p>
      <p><strong>Project Details:</strong><br>
      Project Code: ${escapeHtml(code)}<br>
      Client Code: ${escapeHtml(client)}<br>
      Type: Invalidation Search<br>
      Project Title: ${escapeHtml(title)}<br>
      </p>
      
      <p>Thank you for trusting our expertise.</p>
    `;
  } else if (t.includes("infringement") || t.includes("infringment") || t.includes("clearance")) {
    return `
      <p>Thank you for working with us on this Infringement Study project.<br>
      Your feedback enables us to improve our evaluation of claim mapping and product analysis.</p>

      <p><strong>Project Details:</strong><br>
      Project Code: ${escapeHtml(code)}<br>
      Client Code: ${escapeHtml(client)}<br>
      Type: Infringement Study<br>
      Project Title: ${escapeHtml(title)}<br>
      Product Name: ${escapeHtml(product)}</p>

      <p>We appreciate your continued collaboration.</p>
    `;
  } else {
    return `
      <p>Thank you for collaborating with us on this search.<br>
        Your feedback helps us improve our services and deliver better results.</p>
      <p><strong>Project Details:</strong><br>
      Project Code: ${escapeHtml(code)}<br>
      Client Code: ${escapeHtml(client)}<br>
      Type: ${escapeHtml(type || "Unknown")}<br>
      Project Title: ${escapeHtml(title)}${patent ? `<br>Patent Number: ${escapeHtml(patent)}` : ""}${product ? `<br>Product Name: ${escapeHtml(product)}` : ""}</p>

      <p>Thank you for your valuable partnership.</p>
    `;
  }
}

function showThankYouPage() {
  document.getElementById("feedback-container").style.display = "none";
  document.getElementById("thank-you-container").style.display = "block";
}

function editResponse() {
  const thankYou = document.getElementById("thank-you-container");
  if (thankYou) thankYou.style.display = "none";

  const formCard = document.getElementById("feedback-container");
  if (formCard) formCard.style.display = "block";
}

async function loadProjectData() {
  const urlProject = parseProjectFromUrl();
  if (!urlProject) {
    showError('No project specified. Contact LogicApt at info@logicapt.com)', true);
    return;
  }

  document.getElementById("project-name").textContent = "Loading Project...";

  const projectData = await fetchProjectData(urlProject.clientCode, urlProject.projectCode);
  displayProjectData(projectData);
}

document.addEventListener("DOMContentLoaded", function () {
  loadProjectData();

  document.getElementById("feedbackForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    if (!validateForm()) return;

    const formData = {
      searchQuality:   document.querySelector('input[name="searchQuality"]:checked').value,
      turnaroundTime:  document.querySelector('input[name="turnaroundTime"]:checked').value,
      reporting:       document.querySelector('input[name="reporting"]:checked').value,
      responsiveness:  document.querySelector('input[name="responsiveness"]:checked').value,
      overallRating:   document.querySelector('input[name="overallRating"]:checked').value,
      comments:        document.getElementById("comments").value
    };

    try {
      await submitFeedback(formData, currentProjectData);
      showThankYouPage();
    } catch (err) {
      console.error("Submit error:", err);
      showError(escapeHtml(String(err.message || err)), false);
    }
  });

  document.querySelectorAll('input[type="radio"]').forEach(r => {
    r.addEventListener("change", function () {
      const errEl = document.getElementById(this.name + "Error");
      if (errEl) errEl.style.display = "none";
    });
  });
});
</script>

</body>
</html>






